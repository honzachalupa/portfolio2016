"use strict";function getData(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&200===this.status&&(window.data=JSON.parse(this.responseText),getData_Locally())},e.open("GET","http://www.honzachalupa.cz/dev/data/data.json",!0),e.send()}function getData_Locally(){var e=window,t=e.data,r=0;if(t.length>0){var i=shuffleArray(t),a=structureItems(i);renderItems(a),adjustTiles()}else r<10?(r++,setTimeout(function(){getData_Locally()},200)):alert("Something really bad happened. I'm sorry. :(")}function structureItems(e){var t=[],r=!0,i=!1,a=void 0;try{for(var n,l=e[Symbol.iterator]();!(r=(n=l.next()).done);r=!0){var o=n.value,d=o.Type;if("project"===d)t.push({id:o.Type+"-"+o.Id,type:"item",tile:{type:o.Type,title:o.Title,image:o.ImageUrl1},link:"detail.html?type="+o.Type+"&id="+o.Id,dateCreated:o.DateCreated});else if("image"===d)t.push({id:o.Type+"-"+o.Id,type:"item",tile:{type:o.Type,url:o.Url},link:"detail.html?type="+o.Type+"&id="+o.Id,dateCreated:o.DateCreated});else{if("tweet"!==d)throw new Error("Unknown tile type: "+o.Type);t.push({id:o.Type+"-"+o.Id,type:"item",tile:{type:o.Type,text:o.Text},link:o.Url,dateCreated:o.DateCreated})}}}catch(e){i=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw a}}var s=!0,u=!1,y=void 0;try{for(var c,f=t[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var p=c.value;p.priority=getItemPriority(p)}}catch(e){u=!0,y=e}finally{try{!s&&f.return&&f.return()}finally{if(u)throw y}}var m=getLowPriorityItems(t),h=[];if(m.length>=4)for(var v=0;v<Math.floor(m.length/4);v++)h.push(m[v].id,m[v+1].id,m[v+2].id,m[v+3].id),t.push({type:"items-group",items:[m[v],m[v+1],m[v+2],m[v+3]]});var g=[],w=!0,T=!1,I=void 0;try{for(var x,S=t[Symbol.iterator]();!(w=(x=S.next()).done);w=!0){var b=x.value;b.id&&h.indexOf(b.id)!==-1||g.push(b)}}catch(e){T=!0,I=e}finally{try{!w&&S.return&&S.return()}finally{if(T)throw I}}return g=shuffleArray(g)}function renderItems(e){var t="",r=!0,i=!1,a=void 0;try{for(var n,l=e[Symbol.iterator]();!(r=(n=l.next()).done);r=!0){var o=n.value;if("items-group"===o.type){t+='<div class="items-group">';var d=!0,s=!1,u=void 0;try{for(var y,c=o.items[Symbol.iterator]();!(d=(y=c.next()).done);d=!0){var f=y.value;t+=renderItemContent(f,2)}}catch(e){s=!0,u=e}finally{try{!d&&c.return&&c.return()}finally{if(s)throw u}}t+="</div>"}else{var p=o;t+=renderItemContent(p,1)}}}catch(e){i=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw a}}document.querySelector("#grid-placeholder").innerHTML=t,adjustTiles(),make3dEffect()}function renderItemContent(e,t){var r=e.tile,i=e.tile.type,a='<a class="item level-'+t+" "+i+'" href="'+e.link+'" label="'+getTileLabel(i)+'">';return"project"===i?a+='<div class="image-container" style="background-image: url(\''+r.image+"')\"></div>\n            <p class='title'>"+r.title+"</p>":"image"===i?a+='<div class="image-container" style="background-image: url(\''+r.url+"')\"></div>":"tweet"===i&&(a+='<p class="text">'+r.text+'</p>\n            <div class="icon"></div>'),a+="</a>"}function getItemPriority(e){var t="2016-10-01",r=daysDiff(new Date(t).getTime(),(new Date).getTime()),i="project"===e.tile.type?Math.floor(r/60):Math.ceil(r/20);return"tweet"===e.tile.type&&e.tile.text.length<50&&(i-=2),i<1&&(i=1),i}function getLowPriorityItems(e){var t=[],r=!0,i=!1,a=void 0;try{for(var n,l=e[Symbol.iterator]();!(r=(n=l.next()).done);r=!0){var o=n.value;o.priority>=3&&t.push(o)}}catch(e){i=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw a}}return t}function getTileLabel(e){switch(e){case"project":return"Show details";case"image":return"Show in gallery";case"tweet":return"Visit my Twitter page";default:return""}}function adjustTiles(){var e=window.innerHeight/(isMobile()?5:2),t=Math.floor(window.innerWidth/e);document.querySelectorAll(".items-group, .item.level-1").forEach(function(e){e.style.flexBasis="calc(100% / "+t+")"}),document.querySelectorAll(".item, .items-group").forEach(function(e){e.style.height=e.offsetWidth+"px"})}function make3dEffect(){var e=0;document.querySelectorAll(".grid > .item.tweet").forEach(function(t){t.style.opacity=1-e/20,e++,6===e&&(e=0)})}window.onload=function(){getRelevatControls(),getData()},window.onresize=function(){getRelevatControls(),adjustTiles()};